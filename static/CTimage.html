<!DOCTYPE html>
<html>

<head>
    <title>CT Image Analysis</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 20px;
            color: #333;
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }

        .controls {
            max-width: 800px;
            margin: 0 auto 20px;
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        input[type="file"],
        select,
        button {
            margin: 10px 0;
            padding: 10px;
            font-size: 16px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }

        button {
            background-color: #3498db;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #2980b9;
        }

        button:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }

        #container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .image-box {
            background: #fff;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
            width: 400px;
        }

        .image-box h4 {
            margin: 10px 0;
            color: #34495e;
        }

        img,
        #threeDCanvas {
            width: 100%;
            height: 400px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
    </style>
</head>

<body>
    <h1>CT Image Analysis</h1>
    <div class="controls">
        <input type="file" id="ctFile" accept=".dcm,image/*">
        <button onclick="uploadFile()">Upload</button>
        <h3>Preprocess Options</h3>
        <select id="preprocessMethod">
            <option value="gaussian">Gaussian Filter</option>
            <option value="median">Median Filter</option>
            <option value="wavelet">Wavelet Transform</option>
        </select>
        <button onclick="preprocessImage()">Preprocess</button>
        <button onclick="segmentTumor()">Segment Tumor</button>
        <button onclick="classifyTumor()">Classify Tumor</button>
        <button onclick="reconstruct3D()">3D Reconstruction</button>
    </div>

    <div id="container">
        <div class="image-box">
            <h4>Original Image</h4>
            <img id="originalImg">
        </div>
        <div class="image-box">
            <h4>Processed Image</h4>
            <img id="processedImg">
        </div>
        <div class="image-box">
            <h4>3D View</h4>
            <div id="threeDCanvas"></div>
        </div>
    </div>

    <script>
        let originalImageData, processedImageData;

        function uploadFile() {
            const fileInput = document.getElementById('ctFile');
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);

            axios.post('http://localhost:5000/upload', formData)
                .then(response => {
                    originalImageData = response.data.image;
                    document.getElementById('originalImg').src = 'data:image/png;base64,' + originalImageData;
                });
        }

        function preprocessImage() {
            const method = document.getElementById('preprocessMethod').value;
            axios.post('http://localhost:5000/preprocess', { image: originalImageData, method: method })
                .then(response => {
                    processedImageData = response.data.image;
                    document.getElementById('processedImg').src = 'data:image/png;base64,' + processedImageData;
                });
        }

        function segmentTumor() {
            axios.post('http://localhost:5000/segment', { image: originalImageData })
                .then(response => {
                    processedImageData = response.data.image;
                    document.getElementById('processedImg').src = 'data:image/png;base64,' + processedImageData;
                });
        }

        function classifyTumor() {
            axios.post('http://localhost:5000/classify', { image: processedImageData || originalImageData })
                .then(response => {
                    alert(`Tumor Classification: ${response.data.classification}`);
                });
        }

        function reconstruct3D() {
            axios.post('http://localhost:5000/reconstruct', { image: processedImageData || originalImageData })
                .then(response => {
                    const voxelData = response.data.voxelData;
                    render3D(voxelData);
                });
        }

        function render3D(voxelData) {
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('threeDCanvas') });
            renderer.setSize(400, 400);

            const geometry = new THREE.BufferGeometry();
            const vertices = [];
            for (let x = 0; x < 10; x++) {
                for (let y = 0; y < 10; y++) {
                    for (let z = 0; z < 10; z++) {
                        if (voxelData[x][y][z] > 0) {
                            vertices.push(x, y, z);
                        }
                    }
                }
            }
            geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
            const material = new THREE.MeshBasicMaterial({ color: 0xff0000, wireframe: true });
            const mesh = new THREE.Mesh(geometry, material);
            scene.add(mesh);

            camera.position.z = 20;
            renderer.render(scene, camera);

            function animate() {
                requestAnimationFrame(animate);
                mesh.rotation.x += 0.01;
                mesh.rotation.y += 0.01;
                renderer.render(scene, camera);
            }
            animate();
        }
    </script>
</body>

</html>