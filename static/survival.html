<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>生存分析预测</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        label {
            display: inline-block;
            width: 250px;
            margin: 5px 0;
        }

        input {
            margin: 5px 0;
        }

        button {
            margin-top: 10px;
            padding: 5px 10px;
        }

        #result {
            margin-top: 20px;
        }

        .error {
            color: red;
        }
    </style>
</head>

<body>
    <h1>患者临床数据输入</h1>
    <form id="patientForm">
        <label for="age">年龄（单位：岁，取值范围：0-120）:</label>
        <input type="number" id="age" name="age" min="0" max="120" required><br>
        <label for="gender_code">性别（0=女性，1=男性）:</label>
        <input type="number" id="gender_code" name="gender_code" min="0" max="1" required><br>
        <label for="tumor_size">肿瘤大小（单位：毫米，取值范围：0-1000）:</label>
        <input type="number" id="tumor_size" name="tumor_size" min="0" max="1000" step="0.1" required><br>
        <label for="cea">癌胚抗原水平（单位：ng/mL，若未知输入998或999）:</label>
        <input type="number" id="cea" name="cea" step="0.1" required><br>
        <label for="grade_code">肿瘤分级（1=低级别，2=中级别，3=高级别）:</label>
        <input type="number" id="grade_code" name="grade_code" min="1" max="3" required><br>
        <label for="PNI">神经侵犯（0=无，1=有）:</label>
        <input type="number" id="PNI" name="PNI" min="0" max="1" required><br>
        <label for="lymphcat">淋巴结分类（0=无转移，1=有转移）:</label>
        <input type="number" id="lymphcat" name="lymphcat" min="0" max="1" required><br>
        <button type="submit">提交</button>
    </form>
    <div id="result"></div>

    <script>
        document.getElementById('patientForm').addEventListener('submit', function (event) {
            event.preventDefault();
            const formData = new FormData(this);
            const data = {};
            formData.forEach((value, key) => {
                data[key] = value;
            });

            fetch('http://localhost:5000/predict', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(result => {
                    if (result.error) {
                        document.getElementById('result').innerHTML = `
                        <p class="error">错误: ${result.error}</p>
                        ${result.details ? `<p>详情: ${result.details}</p>` : ''}
                        ${result.output ? `<p>输出: ${result.output}</p>` : ''}
                    `;
                    } else {
                        document.getElementById('result').innerHTML = `
                        <h2>预测结果</h2>
                        <p>患者风险分数: ${result.risk_score}</p>
                        <p>风险分组: ${result.risk_group}</p>
                        <img src="${result.survival_curve_path}" alt="生存曲线" style="max-width: 100%;">
                    `;
                    }
                })
                .catch(error => {
                    console.error('请求错误:', error);
                    document.getElementById('result').innerHTML = `<p class="error">请求失败: ${error.message}</p>`;
                });
        });
    </script>
</body>

</html>